<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Greenwood-Nam-D'Agostino (GND) Test on Autopilot — gnd_test_auto • survival.calib</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Greenwood-Nam-D'Agostino (GND) Test on Autopilot — gnd_test_auto" />
<meta property="og:description" content="The GND test is based on groupwise error rates for observed versus
expected risk, and the test is unstable when any group contains
&amp;lt; 5 events (see Demler et al.). The purpose of gnd_test_auto is
to automatically check event counts in risk groups and, if
necessary, collapse risk groups so that every group has an
event count greater than a given threshold." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survival.calib</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bcjaeger/survival.calib/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Greenwood-Nam-D'Agostino (GND) Test on Autopilot</h1>
    <small class="dont-index">Source: <a href='https://github.com/bcjaeger/survival.calib/blob/master/R/gnd_test_auto.R'><code>R/gnd_test_auto.R</code></a></small>
    <div class="hidden name"><code>gnd_test_auto.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The GND test is based on groupwise error rates for observed versus
expected risk, and the test is unstable when any group contains
&lt; 5 events (see Demler et al.). The purpose of <code>gnd_test_auto</code> is
to automatically check event counts in risk groups and, if
necessary, collapse risk groups so that every group has an
event count greater than a given threshold.</p>
    </div>

    <pre class="usage"><span class='fu'>gnd_test_auto</span><span class='op'>(</span>
  <span class='va'>predicted_risk</span>,
  <span class='va'>event_time</span>,
  <span class='va'>event_status</span>,
  <span class='va'>time_predict</span>,
  group_method <span class='op'>=</span> <span class='st'>"lump"</span>,
  group_count_init <span class='op'>=</span> <span class='fl'>10</span>,
  group_count_min <span class='op'>=</span> <span class='fl'>2</span>,
  group_min_events_warn <span class='op'>=</span> <span class='fl'>5</span>,
  group_min_events_stop <span class='op'>=</span> <span class='fl'>2</span>,
  verbose <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>predicted_risk</th>
      <td><p>(<em>numeric vector</em>) predicted risk values for the
event of interest at or before a given time.</p></td>
    </tr>
    <tr>
      <th>event_time</th>
      <td><p>(<em>numeric vector</em>) observed event times'</p></td>
    </tr>
    <tr>
      <th>event_status</th>
      <td><p>(<em>numeric vector</em>) observed event status. The values
of this vector should be 0 (event censored) and 1 (event observed).</p></td>
    </tr>
    <tr>
      <th>time_predict</th>
      <td><p>(<em>numeric value</em>) the time that risk predictions are
computed for. For example, to assess calibration of 10-year predicted
risk, set <code>time_predict = 10</code>.</p></td>
    </tr>
    <tr>
      <th>group_method</th>
      <td><p>(<em>character value</em>; 'lump' or 'redo') If 'lump', then
a 'lumping' procedure will be applied whenever a group has less than
<code>group_min_events_warn</code> events. The lumping procedure will identify
whichever group has the lowest event count and assign members of that
group to the group with too few events. If 'redo', then the groups
will be re-done using <code>cut_percentile</code> but with one less group.
'lump' is the default as this method was studied by Demler et al.</p></td>
    </tr>
    <tr>
      <th>group_count_init</th>
      <td><p>(<em>integer value</em>) the initial number of
groups to form based on percentiles of <code>predicted_risk</code> values.</p></td>
    </tr>
    <tr>
      <th>group_count_min</th>
      <td><p>(<em>integer value</em>) the minimum number of
groups to attempt running the GND test with. If</p></td>
    </tr>
    <tr>
      <th>group_min_events_warn</th>
      <td><p>(<em>numeric value</em>) The lowest event count
within a risk group that will not cause a warning (see details).</p></td>
    </tr>
    <tr>
      <th>group_min_events_stop</th>
      <td><p>(<em>numeric value</em>) The lowest event count
within a risk group that will not cause a hard stop (see details).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>(<em>integer value</em>) If 0, no output will be printed.
If 1, then output from group reduction will be printed.
If 2, then output from group reduction <strong>and</strong> <a href='gnd_test_manual.html'>gnd_test_manual</a>
will be printed.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>an object of class 'survival.calib_gnd_test'</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Demler, O.V., Paynter, N.P. and Cook, N.R., 2015. Tests of calibration and
goodness‐of‐fit in the survival setting. <em>Statistics in medicine</em>, 34(10),
pp.1659-1680. DOI: 10.1002/sim.6428</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># packages</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tagteam/riskRegression'>riskRegression</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>riskRegression version 2020.12.08</span></div><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span>

<span class='co'># set index for training data</span>
<span class='va'>train_index</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3000</span>

<span class='co'># fit cox PH model using train data</span>
<span class='va'>risk_mdl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/coxph.html'>coxph</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>flchain</span><span class='op'>[</span><span class='va'>train_index</span>, <span class='op'>]</span>,
                  x <span class='op'>=</span> <span class='cn'>TRUE</span>,
                  formula <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>futime</span>, <span class='va'>death</span><span class='op'>)</span><span class='op'>~</span><span class='va'>age</span><span class='op'>+</span><span class='va'>sex</span><span class='op'>+</span><span class='va'>flc.grp</span><span class='op'>+</span><span class='va'>lambda</span><span class='op'>)</span>

<span class='co'># set time of prediction</span>
<span class='va'>time_predict</span> <span class='op'>&lt;-</span> <span class='fl'>4000</span>

<span class='co'># predict risk in the testing data</span>
<span class='va'>risk_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/riskRegression/man/predictRisk.html'>predictRisk</a></span><span class='op'>(</span><span class='va'>risk_mdl</span>,
                         newdata <span class='op'>=</span> <span class='va'>flchain</span><span class='op'>[</span><span class='op'>-</span><span class='va'>train_index</span>, <span class='op'>]</span>,
                         times <span class='op'>=</span> <span class='va'>time_predict</span><span class='op'>)</span>

<span class='co'># run GND test using 10 groups; apply some rules:</span>
<span class='co'>#  1. require at least 40 events per group</span>
<span class='co'>#  2. try to create 10 groups, and lump the lowest event frequency groups</span>
<span class='co'>#     if any groups have less than 40 events.</span>
<span class='co'>#  3. Hard stop if this is not obtainable with 5 or more groups.</span>
<span class='co'>#  4. set verbose = 2 to see every detail.</span>
<span class='co'># (note that these rules are not a recommendation on how to use the test;</span>
<span class='co'>#  this example just shows the mechanics of the automatic group reduction.</span>
<span class='co'>#  The recommended values are the default values.)</span>

<span class='fu'>gnd_test_auto</span><span class='op'>(</span>predicted_risk <span class='op'>=</span> <span class='va'>risk_pred</span>,
              event_time <span class='op'>=</span> <span class='va'>flchain</span><span class='op'>$</span><span class='va'>futime</span><span class='op'>[</span><span class='op'>-</span><span class='va'>train_index</span><span class='op'>]</span>,
              event_status <span class='op'>=</span> <span class='va'>flchain</span><span class='op'>$</span><span class='va'>death</span><span class='op'>[</span><span class='op'>-</span><span class='va'>train_index</span><span class='op'>]</span>,
              time_predict <span class='op'>=</span> <span class='va'>time_predict</span>,
              group_min_events_warn <span class='op'>=</span> <span class='fl'>40</span>,
              group_count_init <span class='op'>=</span> <span class='fl'>10</span>,
              group_count_min <span class='op'>=</span> <span class='fl'>5</span>,
              verbose <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Checking event counts using 10 risk groups...</span></div><div class='output co'>#&gt; <span class='message'>too few; trying again</span></div><div class='output co'>#&gt; <span class='message'>Checking event counts using 9 risk groups...</span></div><div class='output co'>#&gt; <span class='message'>too few; trying again</span></div><div class='output co'>#&gt; <span class='message'>Checking event counts using 8 risk groups...</span></div><div class='output co'>#&gt; <span class='message'>too few; trying again</span></div><div class='output co'>#&gt; <span class='message'>Checking event counts using 7 risk groups...</span></div><div class='output co'>#&gt; <span class='message'>too few; trying again</span></div><div class='output co'>#&gt; <span class='message'>Checking event counts using 6 risk groups...</span></div><div class='output co'>#&gt; <span class='message'>okay</span></div><div class='output co'>#&gt; <span class='message'>Attempting GND test with 6 risk groups.</span></div><div class='output co'>#&gt; <span class='message'>Group 4 (N = 1950)</span>
#&gt; <span class='message'> - 97 events observed (5.4%)</span>
#&gt; <span class='message'> - 83 events expected (4.3%)</span>
#&gt; <span class='message'> - GND component: 4.383</span></div><div class='output co'>#&gt; <span class='message'>Group 6 (N = 974)</span>
#&gt; <span class='message'> - 82 events observed (9.1%)</span>
#&gt; <span class='message'> - 72 events expected (7.4%)</span>
#&gt; <span class='message'> - GND component: 3.139</span></div><div class='output co'>#&gt; <span class='message'>Group 7 (N = 488)</span>
#&gt; <span class='message'> - 47 events observed (10.5%)</span>
#&gt; <span class='message'> - 49 events expected (9.9%)</span>
#&gt; <span class='message'> - GND component: 0.174</span></div><div class='output co'>#&gt; <span class='message'>Group 8 (N = 487)</span>
#&gt; <span class='message'> - 61 events observed (13.4%)</span>
#&gt; <span class='message'> - 60 events expected (12.3%)</span>
#&gt; <span class='message'> - GND component: 0.457</span></div><div class='output co'>#&gt; <span class='message'>Group 9 (N = 487)</span>
#&gt; <span class='message'> - 68 events observed (15.0%)</span>
#&gt; <span class='message'> - 75 events expected (15.5%)</span>
#&gt; <span class='message'> - GND component: 0.075</span></div><div class='output co'>#&gt; <span class='message'>Group 10 (N = 488)</span>
#&gt; <span class='message'> - 108 events observed (23.6%)</span>
#&gt; <span class='message'> - 113 events expected (23.1%)</span>
#&gt; <span class='message'> - GND component: 0.067</span></div><div class='output co'>#&gt; -------------------------------------------------------
#&gt; 
#&gt; - Greenwood-Nam-D'Agostino (GND) Mis-calibration Test
#&gt; 
#&gt; -- Chi-square test statistic: 8.295
#&gt; -- degrees of freedom: 5
#&gt; -- P-value for lack of fit: .14
#&gt; -- Warnings: None
#&gt; 
#&gt; -----------------------------------------------------
#&gt;  
#&gt; - Events data by group (truncated):
#&gt; 
#&gt;  group_label group_n events_observed events_expected
#&gt;            4    1950              97            83.1
#&gt;            6     974              82            72.1
#&gt;            7     488              47            48.5
#&gt;            8     487              61            60.0
#&gt;            9     487              68            75.3
#&gt; 
#&gt; + 1 more rows</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Olga Demler, Byron Jaeger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


